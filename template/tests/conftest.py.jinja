import shutil
import tempfile
from pathlib import Path
from typing import Iterator

import pytest
from fastapi.testclient import TestClient

from {{ project_package }}.main import app


def copy_asset(filename: str, path: Path):
    dest_path = path / filename
    shutil.copy(Path(__file__).with_suffix('').parent / 'assets' / filename, dest_path)

    return dest_path


@pytest.fixture(scope='function')
def temp_dir() -> Iterator[Path]:
    with tempfile.TemporaryDirectory() as td:
        yield Path(td)


@pytest.fixture(scope='session')
def client():
    with TestClient(app) as c:
        yield c
